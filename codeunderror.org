# -*- mode: org; -*-
# -*- org-export-babel-evaluate: nil -*-

#+TITLE: Code || Error || ⚠
#+AUTHOR: Dr.-Ing. Amir Najafi, Abdul Aziz
#+EMAIL: amir.najafi@uni-bremen.de, azizab@uni-bremen.de
#+OPTIONS: ':nil *:t -:t ::t <:t H:3 \n:nil ^:nil arch:headline
#+OPTIONS: author:t c:nil creator:comment d:(not "LOGBOOK") date:t
#+OPTIONS: e:t email:nil f:t inline:t num:t p:nil pri:nil stat:t
#+OPTIONS: tags:t tasks:t tex:t timestamp:t toc:t todo:t |:t
#+PROPERTY: header-args :eval never-export
#+CREATOR: ITEM.IDS
#+EXCLUDE_TAGS: noexport
#+LANGUAGE: en
#+SELECT_TAGS: export
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
#+HTML_HEAD: <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
#+HTML_HEAD: <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>


* Error ⚠ list
+ Innovus
#+BEGIN_SRC
**ERROR: (IMPSYC-300):  Cell topgemmini not found.
**ERROR: (IMPVL-904):   Can't set top cell to "topgemmini" because it does not exist.  Exiting!
Solution: 
set init_design_set_top 1 
#since the default value is 0, so it will look for something defin
#+END_SRC

#+BEGIN_SRC
innovus 1> set init_
init_abstract_view                init_check_output_pin_constant
init_cpf_file                     init_design_netlisttype
init_design_settop                init_design_uniquify
init_flag                         init_gnd_net
init_ignore_pgpin_polarity_check  init_import_mode
init_io_file                      init_layout_view
init_lef_check_mask_shifts        init_lef_file
init_mmmc_file                    init_mmmc_version
init_no_new_assigns               init_oa_default_rule
init_oa_design_cell               init_oa_design_lib
init_oa_design_view               init_oa_foundry_rule
init_oa_ref_lib                   init_oa_search_lib
init_oa_special_rule              init_oa_tech_lib
init_original_verilog_files       init_pwr_net
init_remove_assigns               init_top_cell
init_verilog                      init_verilog_tolerate_port_mismatch
#+END_SRC

* script
+ floorplanwithcpf

#+BEGIN_SRC
##############################################
## Design Mode ##
##############################################

setDesignMode -process 40 

################################################
## Setup physical libraries and input netlist ##
################################################
set defHierChar /
set init_cpf_file ../inData/cpf/fft16.cpf
set init_lef_file {  /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/LowPowerOpenCellLibrary.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/LowPowerOpenCellLibrary.macro.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/LowPowerOpenCellLibrary.tech.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Back_End/lef/NangateOpenCellLibrary.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/AON_BUF_X1.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/AON_BUF_X2.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/AON_BUF_X4.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/AON_INV_X1.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/AON_INV_X2.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/AON_INV_X4.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/LS_HL_X1.lef \
 /usrf01/prog/freepdk/fpdk45_v20/NANGATE/NangateOpenCellLibrary_PDKv1_3_v2010_12/Low_Power/Back_End/lef/LS_LH_X1.lef}



set init_pwr_net {VDD VDD1}
set init_gnd_net {VSS}
set init_top_cell fft16
#set init_verilog ../experiment/fft16_cpfsyn.v

set init_verilog ../approx/netlist/trunck_k6.v


#################
## Read Design ##
#################
init_design
#source ./script/innoGlobal.tcl


################################
## Select Active Timing Views ##
################################
set_analysis_view -setup {AV_normal_mode_wc_rc125_setup} -hold {AV_low_mode_bc_rc0_hold}


###########################
## Read Power Intent CPF ##
###########################
read_power_intent -cpf ../inData/cpf/fft16.cpf

#########################
## Commit Power Intent ##
#########################
commit_power_intent


##########################
#Floorplan Initialization#
##########################
setPinConstraint -side {top bottom} -layer {M2}
setPinConstraint -side {right left} -layer {M3}
floorPlan -r 1 0.7 13 13 13 13


########### IO Placement #########
setPlaceMode -fp false -placeIOPins 1 


###########################
### ADD Ring #####
############################
addRing -nets {VDD VSS} -type core_rings -follow core -layer {top metal5 bottom metal5 left metal6 right metal6} -width 4.5 -spacing 2 -offset 2

################################
## Global VSS GRID generation ##
################################

addStripe \
 -set_to_set_distance 6 \
 -spacing 2 \
 -xleft_offset 0.7 \
 -direction vertical \
 -layer M6 \
 -width 0.35 \
 -nets VSS
addStripe \
 -set_to_set_distance 6 \
 -spacing 2 \
 -ybottom_offset 0.7 \
 -direction horizontal \
 -layer M5 \
 -width 0.35 \
 -nets VSS 

#suspend

###################################################
## fft16 Low Power Domain RING generation ##
###################################################

selectObject Group fft16_LO
#cutRow -halo 0.8 -selected 


deselectAll
selectObject Group fft16_LO
addRing \
 -stacked_via_top_layer AP \
 -around power_domain \
 -type block_rings \
 -nets {VDD1} \
 -layer {bottom M3 top M3 right M4 left M4} \
 -width 2.5\
 -spacing 1 \
 -offset 0

###################################################
## fft16 Low Power Domain GRID generation ##
###################################################
setAddStripeMode -extend_to_closest_target ring
addStripe \
 -over_power_domain 1 \
 -set_to_set_distance 3 \
 -spacing 2 \
 -xleft_offset 0.7 \
 -layer M6 \
 -width 0.35 \
 -nets VDD1

addStripe \
 -over_power_domain 1 \
 -set_to_set_distance 3 \
 -ybottom_offset 0.7 \
 -spacing 2 \
 -direction horizontal \
 -layer M5 \
 -width 0.35 \
 -nets VDD1


####################################################
## Always-On VDD TOP Power Domain GRID generation ##
####################################################
addStripe \
 -nets VDD \
 -direction vertical \
 -layer M6 \
 -xleft_offset 3.7 \
 -width 0.35 \
 -spacing 2 \
 -set_to_set_distance 6 

addStripe \
 -nets VDD \
 -direction horizontal \
 -layer M5 \
 -ybottom_offset 3.7 \
 -width 0.35 \
 -spacing 2 \
 -set_to_set_distance 6

############################################
####### Create Physical Pin ################
############################################

createPhysicalPin -net VSS -layer metal6 -rect {97.83 97.2215 98.0535 101.7905} VSS
createPhysicalPin -net VDD -layer metal6 -rect {91.0245 90.6395 91.216 99.33} VDD
createPhysicalPin -net VDD1 -layer metal4 -rect {85.538 56.9285 100.3125 56.7385} VDD1 


###############################################
##### SRoute##################################
##############################################

setSrouteMode -corePinJoinLimit 6                                       
sroute -connect corePin -nets VSS -allowJogging 0 -corePinMaxViaWidth 60
sroute -connect corePin -nets VDD1 -powerDomains fft16_LO -allowJogging 0 -corePinMaxViaWidth 60
sroute -connect corePin -nets VDD -powerDomains TOP -allowJogging 0 -corePinMaxViaWidth 60


###############
## Reporting ##
###############
#report_timing > ./newReport/floorplanCPF/fft16Cpf.time.rpt
#report_area > ./newReport/floorplanCPF/fft16Cpf.area.rpt
#report_power > ./newReport/floorplanCPF/fft16Cpf.power.rpt


report_timing > ../approx/report/trunck_k6/floorplan/fft16Cpf.time.rpt
report_area > ../approx/report/trunck_k6/floorplan/fft16Cpf.area.rpt
report_power > ../approx/report/trunck_k6/floorplan/fft16Cpf.power.rpt


#Drc checking
verifyGeometry

##Design saving
#saveDesign ../dataOut/designs/floorplanCpf.enc

saveDesign ../approx/design/trunck_k6/floorplanCpf.enc

#+END_SRC

